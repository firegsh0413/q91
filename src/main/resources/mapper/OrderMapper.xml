<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.icchance.q91.mapper.OrderMapper">

    <sql id="BaseColumnList">
        a.ID,a.USER_ID,a.STATUS,
        a.CREATE_TIME,a.UPDATE_TIME,a.TRADE_TIME,
        a.CUT_OFF_TIME,a.SELLER_ID,
        a.AMOUNT,a.ORDER_NUMBER,a.CERT,a.SELLER_GATEWAY_ID,a.BUYER_GATEWAY_ID
    </sql>
    <sql id="SellerColumnList">
        seller.USERNAME sellerUsername
    </sql>

    <resultMap id="getOrderResult" type="com.icchance.q91.entity.vo.OrderVO" >
        <result column="ID" jdbcType="INTEGER" property="id" />
        <result column="USER_ID" jdbcType="INTEGER" property="userId" />
        <result column="STATUS" jdbcType="INTEGER" property="status" />
        <result column="CREATE_TIME" jdbcType="TIMESTAMP" property="createTime" />
        <result column="UPDATE_TIME" jdbcType="TIMESTAMP" property="updateTime" />
        <result column="TRADE_TIME" jdbcType="TIMESTAMP" property="tradeTime" />
        <result column="CUT_OFF_TIME" jdbcType="TIMESTAMP" property="cutOffTime" />
        <result column="SELLER_ID" jdbcType="INTEGER" property="sellerId" />
        <result column="SELLER_USERNAME" jdbcType="VARCHAR" property="sellerUsername" />
        <result column="AMOUNT" jdbcType="DECIMAL" property="amount" />
        <result column="ORDER_NUMBER" jdbcType="VARCHAR" property="orderNumber" />
    </resultMap>

    <select id="getOrderList" resultMap="getOrderResult">
        SELECT
            <include refid="BaseColumnList" />,
            <include refid="SellerColumnList" />
        FROM q91.ORDER a
        INNER JOIN USER seller ON a.SELLER_ID = seller.ID
        INNER JOIN USER buyer ON a.USER_ID = buyer.ID
        <where>
            <if test="null != userId and '' != userId">
                AND a.USER_ID = #{userId}
            </if>
        </where>
    </select>

    <sql id="SellerGatewayColumnList">
        sellerGateway.ID sellerGatewayId, sellerGateway.TYPE sellerGatewayType, sellerGateway.USER_ID sellerId,
        sellerGateway.NAME sellerName, sellerGateway.GATEWAY_NAME sellerGatewayName,
        sellerGateway.GATEWAY_ACCOUNT sellerGatewayAccount,
        sellerGateway.GATEWAY_RECEIPT_CODE sellerGatewayReceiptCode
    </sql>

    <sql id="BuyerGatewayColumnList">
        buyerGateway.ID buyerGatewayId, buyerGateway.TYPE buyerGatewayType, buyerGateway.USER_ID buyerId,
        buyerGateway.NAME buyerName, buyerGateway.GATEWAY_NAME buyerGatewayName,
        buyerGateway.GATEWAY_ACCOUNT buyerGatewayAccount,
        buyerGateway.GATEWAY_RECEIPT_CODE buyerGatewayReceiptCode
    </sql>

    <resultMap id="getOrderDetailResult" type="com.icchance.q91.entity.vo.OrderVO" >
        <result column="ID" jdbcType="INTEGER" property="id" />
        <result column="USER_ID" jdbcType="INTEGER" property="userId" />
        <result column="STATUS" jdbcType="INTEGER" property="status" />
        <result column="CREATE_TIME" jdbcType="TIMESTAMP" property="createTime" />
        <result column="UPDATE_TIME" jdbcType="TIMESTAMP" property="updateTime" />
        <result column="TRADE_TIME" jdbcType="TIMESTAMP" property="tradeTime" />
        <result column="SELLER_ID" jdbcType="INTEGER" property="sellerId" />
        <result column="SELLER_USERNAME" jdbcType="VARCHAR" property="sellerUsername" />
        <result column="sellerGatewayId" jdbcType="INTEGER" property="sellerGatewayId" />
        <result column="buyerGatewayId" jdbcType="INTEGER" property="buyerGatewayId" />
        <result column="AMOUNT" jdbcType="DECIMAL" property="amount" />
        <result column="ORDER_NUMBER" jdbcType="VARCHAR" property="orderNumber" />
        <collection property="sellerInfo" ofType="com.icchance.q91.entity.model.Gateway">
            <id column="sellerGatewayId" property="id" jdbcType="INTEGER" />
            <result column="sellerId" property="userId" jdbcType="INTEGER" />
            <result column="sellerGatewayType" property="type" jdbcType="INTEGER" />
            <result column="sellerName" property="name" jdbcType="VARCHAR" />
            <result column="sellerGatewayName" property="gatewayName" jdbcType="VARCHAR" />
            <result column="sellerGatewayAccount" property="gatewayAccount" jdbcType="VARCHAR" />
            <result column="sellerGatewayReceiptCode" property="gatewayReceiptCode" jdbcType="VARCHAR" />
        </collection>
        <collection property="buyerInfo" ofType="com.icchance.q91.entity.model.Gateway">
            <id column="buyerGatewayId" property="id" jdbcType="INTEGER" />
            <result column="buyerId" property="userId" jdbcType="INTEGER" />
            <result column="buyerGatewayType" property="type" jdbcType="INTEGER" />
            <result column="buyerName" property="name" jdbcType="VARCHAR" />
            <result column="buyerGatewayName" property="gatewayName" jdbcType="VARCHAR" />
            <result column="buyerGatewayAccount" property="gatewayAccount" jdbcType="VARCHAR" />
            <result column="buyerGatewayReceiptCode" property="gatewayReceiptCode" jdbcType="VARCHAR" />
        </collection>
    </resultMap>

    <select id="getOrderDetail" resultMap="getOrderDetailResult">
        SELECT
            <include refid="BaseColumnList" />,
            <include refid="SellerColumnList" />,
            <include refid="SellerGatewayColumnList" />,
            <include refid="BuyerGatewayColumnList" />
        FROM q91.ORDER a
        INNER JOIN USER seller ON a.SELLER_ID = seller.ID
        INNER JOIN USER buyer ON a.USER_ID = buyer.ID
        INNER JOIN GATEWAY sellerGateway ON a.SELLER_GATEWAY_ID = sellerGateway.ID
        INNER JOIN GATEWAY buyerGateway ON a.BUYER_GATEWAY_ID = buyerGateway.ID
        <where>
            <if test="null != orderId and '' != orderId">
                AND a.ID = #{orderId}
            </if>
            <if test="null != userId and '' != userId">
                AND a.USER_ID = #{userId}
            </if>
        </where>
    </select>
</mapper>
